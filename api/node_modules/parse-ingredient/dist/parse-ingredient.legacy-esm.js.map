{"version":3,"sources":["../src/parseIngredient.ts","../src/constants.ts","../src/utils.ts"],"sourcesContent":["import { numericQuantity } from 'numeric-quantity';\nimport {\n  defaultOptions,\n  firstWordRegEx,\n  forsRegEx,\n  ofRegEx,\n  rangeSeparatorRegEx,\n  unitsOfMeasure,\n} from './constants';\nimport type { Ingredient, ParseIngredientOptions, UnitOfMeasure } from './types';\nimport { compactStringArray } from './utils';\n\nconst newLineRegExp = /\\r?\\n/;\n\nconst addIdToUomDefinition = ([uom, def]: [string, UnitOfMeasure]) => ({ id: uom, ...def });\n\n/**\n * Parses a string into an array of recipe ingredient objects\n * @param ingText The ingredient text\n * @param options Configuration options\n */\nexport const parseIngredient = (\n  ingText: string,\n  options: ParseIngredientOptions = defaultOptions\n): Ingredient[] => {\n  const opts = { ...defaultOptions, ...options };\n  const mergedUOMs = { ...unitsOfMeasure, ...opts.additionalUOMs };\n  const uomArray = Object.entries(mergedUOMs).map(addIdToUomDefinition);\n  const uomArrayLength = uomArray.length;\n\n  return compactStringArray(ingText.split(newLineRegExp)).map(line => {\n    const oIng: Ingredient = {\n      quantity: null,\n      quantity2: null,\n      unitOfMeasureID: null,\n      unitOfMeasure: null,\n      description: '',\n      isGroupHeader: false,\n    };\n\n    // Check if the first character is numeric.\n    const nqResultFirstChar = numericQuantity(line.substring(0, 1));\n\n    if (isNaN(nqResultFirstChar)) {\n      // The first character is not numeric, so the entire line is the description.\n      oIng.description = line;\n\n      // If the line ends with \":\" or starts with \"For \", then it is assumed to be a group header.\n      if (oIng.description.endsWith(':') || forsRegEx.test(oIng.description)) {\n        oIng.isGroupHeader = true;\n      }\n    } else {\n      // The first character is numeric. See how many of the first seven\n      // constitute a single value. This will be `quantity`.\n      let lenNum = 6;\n      let nqResult = NaN;\n\n      while (lenNum > 0 && isNaN(nqResult)) {\n        nqResult = numericQuantity(line.substring(0, lenNum).trim());\n\n        if (nqResult > -1) {\n          oIng.quantity = nqResult;\n          oIng.description = line.substring(lenNum).trim();\n        }\n\n        lenNum--;\n      }\n    }\n\n    // Now check the description for a `quantity2` at the beginning.\n    // First we look for a dash, emdash, endash, \"to \", or \"or \" to\n    // indicate a range, then process the next seven characters just\n    // like we did for `quantity`.\n    const q2reMatch = rangeSeparatorRegEx.exec(oIng.description);\n    if (q2reMatch) {\n      const q2reMatchLen = q2reMatch[1].length;\n      const nqResultFirstChar = numericQuantity(oIng.description.substring(q2reMatchLen).trim()[0]);\n\n      if (!isNaN(nqResultFirstChar)) {\n        let lenNum = 7;\n        let nqResult = NaN;\n\n        while (--lenNum > 0 && isNaN(nqResult)) {\n          nqResult = numericQuantity(oIng.description.substring(q2reMatchLen, lenNum));\n\n          if (!isNaN(nqResult)) {\n            oIng.quantity2 = nqResult;\n            oIng.description = oIng.description.substring(lenNum).trim();\n          }\n        }\n      }\n    }\n\n    // Check for a known unit of measure\n    const firstWordREMatches = firstWordRegEx.exec(oIng.description);\n\n    if (firstWordREMatches) {\n      const firstWord = firstWordREMatches[1].replace(/\\s+/g, ' ');\n      const remainingDesc = (firstWordREMatches[2] ?? '').trim();\n      if (remainingDesc) {\n        let uom = '';\n        let uomID = '';\n        let i = -1;\n\n        while (++i < uomArrayLength && !uom) {\n          const { alternates, id, short, plural } = uomArray[i];\n          const versions = [...alternates, id, short, plural];\n          if (versions.includes(firstWord)) {\n            uom = firstWord;\n            uomID = id;\n          }\n        }\n\n        if (uom) {\n          oIng.unitOfMeasureID = uomID;\n          oIng.unitOfMeasure = opts.normalizeUOM ? uomID : uom;\n          oIng.description = remainingDesc;\n        }\n      }\n    }\n\n    if (!opts.allowLeadingOf && oIng.description.match(ofRegEx)) {\n      oIng.description = oIng.description.replace(ofRegEx, '');\n    }\n\n    return oIng;\n  });\n};\n","import { ParseIngredientOptions, UnitOfMeasureDefinitions } from './types';\n\nexport const defaultOptions = {\n  additionalUOMs: {},\n  allowLeadingOf: false,\n  normalizeUOM: false,\n} satisfies Required<ParseIngredientOptions>;\n\nexport const fors = ['For'] as const;\nexport const forsRegEx = new RegExp(`^(?:${fors.join('|')})\\\\s`, 'i');\n\nexport const rangeSeparatorWords = ['or', 'to'] as const;\nexport const rangeSeparatorRegEx = new RegExp(\n  `^(-|–|—|(?:${rangeSeparatorWords.join('|')})\\\\s)`,\n  'i'\n);\n\nexport const firstWordRegEx = /^(fl(?:uid)?(?:\\s+|-)(?:oz|ounces?)|\\w+[-.]?)(.+)?/;\n\nexport const ofs = ['of'] as const;\nexport const ofRegEx = new RegExp(`^(?:${ofs.join('|')})\\\\s+`, 'i');\n\nexport const unitsOfMeasure = {\n  bag: { short: 'bag', plural: 'bags', alternates: [] },\n  box: { short: 'box', plural: 'boxes', alternates: [] },\n  bunch: { short: 'bunch', plural: 'bunches', alternates: [] },\n  can: { short: 'can', plural: 'cans', alternates: [] },\n  carton: { short: 'carton', plural: 'cartons', alternates: [] },\n  centimeter: { short: 'cm', plural: 'centimeters', alternates: ['cm.'] },\n  clove: { short: 'clove', plural: 'cloves', alternates: [] },\n  container: { short: 'container', plural: 'containers', alternates: [] },\n  cup: { short: 'c', plural: 'cups', alternates: ['c.', 'C'] },\n  dash: { short: 'dash', plural: 'dashes', alternates: [] },\n  drop: { short: 'drop', plural: 'drops', alternates: [] },\n  ear: { short: 'ear', plural: 'ears', alternates: [] },\n  'fluid ounce': { short: 'fl oz', plural: 'fluid ounces', alternates: ['fluidounce', 'floz', 'fl-oz', 'fluid-ounce', 'fluid-ounces', 'fluidounces', 'fl ounce', 'fl ounces', 'fl-ounce', 'fl-ounces', 'fluid oz', 'fluid-oz'] }, // prettier-ignore\n  foot: { short: 'ft', plural: 'feet', alternates: ['ft.'] },\n  gallon: { short: 'gal', plural: 'gallons', alternates: ['gal.'] },\n  gram: { short: 'g', plural: 'grams', alternates: ['g.'] },\n  head: { short: 'head', plural: 'heads', alternates: [] },\n  inch: { short: 'in', plural: 'inches', alternates: ['in.'] },\n  kilogram: { short: 'kg', plural: 'kilograms', alternates: ['kg.'] },\n  large: { short: 'lg', plural: 'large', alternates: ['lg', 'lg.'] },\n  liter: { short: 'l', plural: 'liters', alternates: [] },\n  medium: { short: 'md', plural: 'medium', alternates: ['med', 'med.', 'md.'] },\n  meter: { short: 'm', plural: 'meters', alternates: ['m.'] },\n  milligram: { short: 'mg', plural: 'milligrams', alternates: ['mg.'] },\n  milliliter: { short: 'ml', plural: 'milliliters', alternates: ['mL', 'ml.', 'mL.'] },\n  millimeter: { short: 'mm', plural: 'millimeters', alternates: ['mm.'] },\n  ounce: { short: 'oz', plural: 'ounces', alternates: ['oz.'] },\n  pack: { short: 'pack', plural: 'packs', alternates: [] },\n  package: { short: 'pkg', plural: 'packages', alternates: ['pkg.', 'pkgs'] },\n  piece: { short: 'piece', plural: 'pieces', alternates: ['pcs', 'pcs.'] },\n  pinch: { short: 'pinch', plural: 'pinches', alternates: [] },\n  pint: { short: 'pt', plural: 'pints', alternates: ['pt.'] },\n  pound: { short: 'lb', plural: 'pounds', alternates: ['lb.', 'lbs', 'lbs.'] },\n  quart: { short: 'qt', plural: 'quarts', alternates: ['qt.', 'qts', 'qts.'] },\n  small: { short: 'sm', plural: 'small', alternates: ['sm.'] },\n  sprig: { short: 'sprig', plural: 'sprigs', alternates: [] },\n  stick: { short: 'stick', plural: 'sticks', alternates: [] },\n  tablespoon: { short: 'tbsp', plural: 'tablespoons', alternates: ['tbsp.', 'T', 'Tbsp.'] },\n  teaspoon: { short: 'tsp', plural: 'teaspoons', alternates: ['tsp.', 't'] },\n  yard: { short: 'yd', plural: 'yards', alternates: ['yd.', 'yds.'] },\n} satisfies UnitOfMeasureDefinitions;\n","/**\n * Removes falsy values from an array\n *\n * Originally from lodash: https://github.com/lodash/lodash/blob/4.17.15/lodash.js#L6874\n */\nexport const compactStringArray = (array: string[]) => {\n  let index = -1;\n  const length = array.length;\n  let resIndex = 0;\n  const result: string[] = [];\n\n  while (++index < length) {\n    const value = array[index].trim();\n    // istanbul ignore else\n    if (value) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n};\n"],"mappings":"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","names":["nqResultFirstChar"]}